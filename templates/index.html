{% extends "base.html" %}

{% block title %}Home - Cuneiform Line Splitting System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-4 text-primary">
                <i class="fas fa-cube"></i> Cuneiform Line Splitting System
            </h1>
            <p class="lead">Advanced line detection and splitting using splitting-1.txt methods</p>
        </div>

        <!-- Features -->
        <div class="row mb-5">
            <div class="col-md-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-search fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Automatic Detection</h5>
                        <p class="card-text">Automatically detects line numbers on left/right edges using EasyOCR</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-crop fa-3x text-success mb-3"></i>
                        <h5 class="card-title">Special Padding</h5>
                        <p class="card-text">Fixed top/bottom boundaries, expanded padding system for middle lines</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 text-center">
                    <div class="card-body">
                        <i class="fas fa-download fa-3x text-info mb-3"></i>
                        <h5 class="card-title">Individual Download</h5>
                        <p class="card-text">Download each line as separate JPG file or bulk download as ZIP</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Form -->
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-upload"></i> Upload Cuneiform Photo
                </h4>
            </div>
            <div class="card-body">
                <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                    <div class="mb-4">
                        <label for="file" class="form-label">
                            <i class="fas fa-image"></i> Select Photo
                        </label>
                        <input type="file" class="form-control form-control-lg" id="file" name="file" 
                               accept="image/*" required>
                        <div class="form-text">
                            Supported formats: PNG, JPG, JPEG, GIF, BMP, TIFF (Maximum 16MB)
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Important:</strong> The photo must contain line numbers on the left or right edge.
                            The system detects these numbers and automatically splits the lines.
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="uploadBtn">
                            <i class="fas fa-magic"></i> Start Line Splitting Process
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- How it Works -->
        <div class="card mt-5">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-cogs"></i> How It Works?
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5>1. Line Number Detection</h5>
                        <p>Scans the left or right 15% area to detect line numbers.</p>
                        
                        <h5>2. Special Padding System</h5>
                        <ul>
                            <li><strong>Top Line:</strong> Fixed top boundary (20px), expanded bottom boundary (150px)</li>
                            <li><strong>Middle Lines:</strong> Both boundaries expanded (150px)</li>
                            <li><strong>Bottom Line:</strong> Expanded top boundary (150px), fixed bottom boundary (20px)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>3. Collision Control</h5>
                        <p>Ensures minimum 20px distance between lines and automatically corrects overlaps.</p>
                        
                        <h5>4. Visualization</h5>
                        <p>Creates main visualization and summary visualization, saves each line as separate file.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Specs -->
        <div class="card mt-4">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-chart-line"></i> Technical Specifications
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <div class="bg-primary text-white rounded p-3 mb-2">
                            <i class="fas fa-eye fa-2x"></i>
                        </div>
                        <h6>OCR Engine</h6>
                        <small>EasyOCR + Tesseract</small>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="bg-success text-white rounded p-3 mb-2">
                            <i class="fas fa-ruler fa-2x"></i>
                        </div>
                        <h6>Minimum Distance</h6>
                        <small>20px (almost touching)</small>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="bg-info text-white rounded p-3 mb-2">
                            <i class="fas fa-percentage fa-2x"></i>
                        </div>
                        <h6>Success Rate</h6>
                        <small>43%-100% range</small>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="bg-warning text-white rounded p-3 mb-2">
                            <i class="fas fa-file-image fa-2x"></i>
                        </div>
                        <h6>Output Format</h6>
                        <small>JPG + ZIP</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('uploadForm').addEventListener('submit', function(e) {
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('file');
    
    if (fileInput.files.length === 0) {
        e.preventDefault();
        alert('Please select a file!');
        return;
    }
    
    // Disable upload button
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    
    // Form will submit automatically
});
</script>
{% endblock %}
